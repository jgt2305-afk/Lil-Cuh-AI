<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Lil Cuh AI</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --pink:#ff3b9d;
  --red:#ff1f3d;
  --bg:#0a000f;
  --panel:#120018;
  --soft:#1a0023;
}

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
}

html, body{
  width:100%;
  height:100%;
  overflow:hidden;
  font-family:'Inter',sans-serif;
}

body{
  background:radial-gradient(circle at top, #24001a, var(--bg));
  display:flex;
  justify-content:center;
  align-items:center;
  color:white;
}

.app{
  width:95%;
  max-width:1000px;
  height:92vh;
  background:rgba(18,0,24,.92);
  border-radius:22px;
  box-shadow:0 0 45px rgba(255,59,157,.45);
  display:flex;
  flex-direction:column;
  padding:18px;
}

.header{
  text-align:center;
  padding-bottom:10px;
  border-bottom:1px solid rgba(255,59,157,.25);
  flex-shrink:0;
}

.header h1{
  margin:0 0 4px 0;
  font-size:26px;
  color:var(--pink);
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
}

.status-dot{
  width:8px;
  height:8px;
  border-radius:50%;
  background:#4ade80;
  animation:pulse 2s infinite;
}

@keyframes pulse{
  0%,100%{opacity:1;}
  50%{opacity:.5;}
}

.header p{
  margin:0;
  font-size:13px;
  opacity:.7;
}

.controls{
  display:flex;
  gap:8px;
  justify-content:center;
  margin-top:8px;
  flex-wrap:wrap;
}

.controls button{
  padding:6px 12px;
  border:1px solid rgba(255,59,157,.3);
  border-radius:8px;
  background:rgba(255,59,157,.1);
  color:var(--pink);
  font-size:11px;
  cursor:pointer;
  transition:all .2s;
  font-family:inherit;
}

.controls button:hover{
  background:rgba(255,59,157,.2);
  transform:translateY(-1px);
}

.memory-indicator{
  font-size:10px;
  opacity:.5;
  margin-top:4px;
}

.chat{
  flex:1;
  margin-top:12px;
  padding:14px;
  background:var(--panel);
  border-radius:16px;
  overflow-y:auto;
  overflow-x:hidden;
  min-height:0;
}

.chat::-webkit-scrollbar{
  width:8px;
}

.chat::-webkit-scrollbar-track{
  background:rgba(255,59,157,.1);
  border-radius:4px;
}

.chat::-webkit-scrollbar-thumb{
  background:rgba(255,59,157,.3);
  border-radius:4px;
}

.message{
  max-width:75%;
  margin-bottom:14px;
  padding:12px 14px;
  border-radius:14px;
  line-height:1.5;
  font-size:14px;
  animation:slideIn .3s ease;
  word-wrap:break-word;
  overflow-wrap:break-word;
}

@keyframes slideIn{
  from{opacity:0;transform:translateY(10px);}
  to{opacity:1;transform:translateY(0);}
}

.user{
  margin-left:auto;
  background:linear-gradient(90deg,#1f1f1f,#121212);
  color:white;
}

.bot{
  background:rgba(255,59,157,.15);
  border:1px solid rgba(255,59,157,.4);
  color:white;
  white-space:pre-wrap;
}

.thinking{
  opacity:.6;
  font-style:italic;
}

.message-actions{
  display:flex;
  gap:6px;
  margin-top:8px;
  font-size:11px;
}

.message-actions button{
  padding:4px 8px;
  border:1px solid rgba(255,59,157,.2);
  border-radius:6px;
  background:rgba(0,0,0,.3);
  color:rgba(255,255,255,.6);
  cursor:pointer;
  transition:all .2s;
  font-family:inherit;
}

.message-actions button:hover{
  background:rgba(255,59,157,.2);
  color:white;
}

.message img{
  max-width:100%;
  height:auto;
  border-radius:8px;
  margin-top:8px;
  display:block;
}

.suggestions{
  display:flex;
  gap:6px;
  flex-wrap:wrap;
  margin-top:8px;
  padding:0 14px;
  flex-shrink:0;
}

.suggestion-chip{
  padding:6px 12px;
  border:1px solid rgba(255,59,157,.2);
  border-radius:12px;
  background:rgba(255,59,157,.05);
  color:rgba(255,255,255,.7);
  font-size:12px;
  cursor:pointer;
  transition:all .2s;
  font-family:inherit;
}

.suggestion-chip:hover{
  background:rgba(255,59,157,.15);
  border-color:rgba(255,59,157,.4);
  color:white;
}

.input-area{
  display:flex;
  gap:10px;
  margin-top:10px;
  align-items:flex-end;
  flex-shrink:0;
}

.input-wrapper{
  flex:1;
  position:relative;
}

.file-preview-area{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  padding:0 0 8px 0;
}

.file-preview-item{
  position:relative;
  padding:8px 12px;
  background:rgba(255,59,157,.15);
  border:1px solid rgba(255,59,157,.3);
  border-radius:8px;
  font-size:12px;
  display:flex;
  align-items:center;
  gap:6px;
}

.file-preview-item button{
  background:none;
  border:none;
  color:var(--red);
  cursor:pointer;
  font-size:16px;
  padding:0;
  line-height:1;
  font-family:inherit;
}

.file-preview-item img{
  width:30px;
  height:30px;
  object-fit:cover;
  border-radius:4px;
}

.input-area textarea{
  width:100%;
  padding:14px 14px 34px 14px;
  border-radius:14px;
  border:none;
  outline:none;
  background:var(--soft);
  color:white;
  font-size:14px;
  resize:none;
  font-family:inherit;
  min-height:50px;
  max-height:120px;
}

.input-area textarea::placeholder{
  color:rgba(255,255,255,.5);
}

.input-area textarea:disabled{
  opacity:.5;
  cursor:not-allowed;
}

.input-tools{
  position:absolute;
  bottom:8px;
  left:8px;
  display:flex;
  gap:6px;
}

.input-tools button{
  padding:4px 8px;
  border:1px solid rgba(255,59,157,.2);
  border-radius:6px;
  background:rgba(0,0,0,.3);
  color:rgba(255,255,255,.6);
  cursor:pointer;
  font-size:11px;
  transition:all .2s;
  font-family:inherit;
}

.input-tools button:hover{
  background:rgba(255,59,157,.2);
  color:white;
}

.send-btn{
  padding:14px 22px;
  border:none;
  border-radius:14px;
  cursor:pointer;
  font-weight:600;
  background:linear-gradient(90deg,var(--pink),var(--red));
  color:black;
  transition:transform .2s;
  align-self:flex-end;
  font-family:inherit;
  font-size:14px;
}

.send-btn:hover:not(:disabled){
  transform:scale(1.05);
}

.send-btn:disabled{
  opacity:.5;
  cursor:not-allowed;
}

.code-panel{
  margin-top:10px;
  height:180px;
  background:#060008;
  border-radius:16px;
  padding:40px 14px 14px 14px;
  overflow:auto;
  font-size:12px;
  font-family:'Courier New', monospace;
  white-space:pre-wrap;
  word-wrap:break-word;
  box-shadow:inset 0 0 18px rgba(255,31,61,.35);
  display:none;
  position:relative;
  flex-shrink:0;
}

.code-panel.visible{
  display:block;
}

.code-panel::-webkit-scrollbar{
  width:8px;
  height:8px;
}

.code-panel::-webkit-scrollbar-track{
  background:rgba(255,59,157,.1);
}

.code-panel::-webkit-scrollbar-thumb{
  background:rgba(255,59,157,.3);
  border-radius:4px;
}

.copy-btn{
  position:absolute;
  top:10px;
  right:10px;
  padding:6px 12px;
  border:1px solid rgba(255,59,157,.3);
  border-radius:6px;
  background:rgba(0,0,0,.5);
  color:var(--pink);
  cursor:pointer;
  font-size:11px;
  font-family:'Inter',sans-serif;
  z-index:10;
}

.copy-btn:hover{
  background:rgba(255,59,157,.2);
}

.preview-frame{
  width:100%;
  height:260px;
  margin-top:10px;
  border-radius:16px;
  border:1px solid rgba(255,59,157,.4);
  background:white;
  display:none;
  flex-shrink:0;
}

.preview-frame.visible{
  display:block;
}

.footer{
  text-align:center;
  font-size:11px;
  opacity:.6;
  margin-top:6px;
  flex-shrink:0;
}

#fileInput{
  display:none;
}

.error-message{
  background:rgba(255,31,61,.2);
  border:1px solid var(--red);
  padding:12px;
  border-radius:8px;
  margin:10px 0;
  font-size:13px;
}
</style>
</head>

<body>
<div class="app">
  <div class="header">
    <h1>
      <span class="status-dot"></span>
      Lil Cuh AI
    </h1>
    <p>Ultra-intelligent: Coding + Health + Master Chef + Vision AI</p>
    <div class="controls">
      <button id="clearMemBtn">Clear Memory</button>
      <button id="showMemBtn">Show Memory</button>
      <button id="exportBtn">Export Code</button>
      <button id="newProjBtn">New Project</button>
    </div>
    <div class="memory-indicator" id="memoryIndicator">Memory: 0 projects tracked</div>
  </div>

  <div id="chat" class="chat"></div>

  <div id="suggestions" class="suggestions"></div>

  <div class="input-area">
    <div class="input-wrapper">
      <div id="filePreviewArea" class="file-preview-area"></div>
      <textarea id="input" placeholder="Tell me what you want to build, ask health questions, or attach files..."></textarea>
      <div class="input-tools">
        <button id="attachBtn">Attach</button>
        <button id="imageGenBtn">Gen Image</button>
        <button id="debugBtn">Debug</button>
      </div>
    </div>
    <button id="sendBtn" class="send-btn">Send</button>
  </div>

  <input type="file" id="fileInput" multiple accept="image/*,.pdf,.html,.css,.js,.json,.txt,.md">

  <div id="codePanel" class="code-panel">
    <button class="copy-btn" id="copyBtn">Copy</button>
    <div id="codeContent"></div>
  </div>

  <iframe id="preview" class="preview-frame" sandbox="allow-scripts allow-same-origin"></iframe>

  <div class="footer">Powered by Claude AI</div>
</div>

<script>
(function() {
  'use strict';

  // DOM Elements
  const elements = {
    chat: document.getElementById('chat'),
    input: document.getElementById('input'),
    sendBtn: document.getElementById('sendBtn'),
    suggestions: document.getElementById('suggestions'),
    memoryIndicator: document.getElementById('memoryIndicator'),
    filePreviewArea: document.getElementById('filePreviewArea'),
    fileInput: document.getElementById('fileInput'),
    codePanel: document.getElementById('codePanel'),
    codeContent: document.getElementById('codeContent'),
    preview: document.getElementById('preview'),
    attachBtn: document.getElementById('attachBtn'),
    imageGenBtn: document.getElementById('imageGenBtn'),
    debugBtn: document.getElementById('debugBtn'),
    copyBtn: document.getElementById('copyBtn'),
    clearMemBtn: document.getElementById('clearMemBtn'),
    showMemBtn: document.getElementById('showMemBtn'),
    exportBtn: document.getElementById('exportBtn'),
    newProjBtn: document.getElementById('newProjBtn')
  };

  // State
  const state = {
    attachedFiles: [],
    projectMemory: [],
    conversationHistory: [],
    currentProject: null,
    isProcessing: false
  };

  // Utility Functions
  function scrollChatToBottom() {
    elements.chat.scrollTop = elements.chat.scrollHeight;
  }

  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  function addMessage(text, type, actions, imageUrl) {
    const div = document.createElement('div');
    div.className = 'message ' + type;
    
    if (imageUrl) {
      const img = document.createElement('img');
      img.src = imageUrl;
      img.alt = 'Generated image';
      div.appendChild(img);
    } else {
      div.textContent = text;
    }
    
    if (actions && actions.length > 0) {
      const actionsDiv = document.createElement('div');
      actionsDiv.className = 'message-actions';
      actions.forEach(action => {
        const btn = document.createElement('button');
        btn.textContent = action.label;
        btn.addEventListener('click', action.handler);
        actionsDiv.appendChild(btn);
      });
      div.appendChild(actionsDiv);
    }
    
    elements.chat.appendChild(div);
    scrollChatToBottom();
    return div;
  }

  function showThinking() {
    return addMessage('Thinking...', 'bot thinking');
  }

  function removeMessage(element) {
    if (element && element.parentNode) {
      element.parentNode.removeChild(element);
    }
  }

  function showSuggestions(suggestions) {
    elements.suggestions.innerHTML = '';
    suggestions.forEach(s => {
      const chip = document.createElement('div');
      chip.className = 'suggestion-chip';
      chip.textContent = s;
      chip.addEventListener('click', () => {
        elements.input.value = s;
        sendMessage();
      });
      elements.suggestions.appendChild(chip);
    });
  }

  function updateMemoryIndicator() {
    elements.memoryIndicator.textContent = `Memory: ${state.projectMemory.length} projects tracked`;
  }

  // File Handling
  function fileToBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result.split(',')[1]);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  async function handleFiles(files) {
    for (let file of files) {
      try {
        const fileData = {
          name: file.name,
          type: file.type,
          size: file.size
        };
        
        if (file.type.startsWith('image/')) {
          fileData.base64 = await fileToBase64(file);
          fileData.preview = URL.createObjectURL(file);
        } else {
          fileData.text = await file.text();
        }
        
        state.attachedFiles.push(fileData);
        displayFilePreview(fileData);
      } catch (error) {
        console.error('Error handling file:', error);
        addMessage(`Error loading file: ${file.name}`, 'bot');
      }
    }
  }

  function displayFilePreview(fileData) {
    const item = document.createElement('div');
    item.className = 'file-preview-item';
    
    if (fileData.preview) {
      const img = document.createElement('img');
      img.src = fileData.preview;
      img.alt = fileData.name;
      item.appendChild(img);
    }
    
    const name = document.createElement('span');
    name.textContent = fileData.preview ? fileData.name : 'ðŸ“„ ' + fileData.name;
    item.appendChild(name);
    
    const removeBtn = document.createElement('button');
    removeBtn.textContent = 'Ã—';
    removeBtn.addEventListener('click', () => removeFile(fileData.name));
    item.appendChild(removeBtn);
    
    elements.filePreviewArea.appendChild(item);
  }

  function removeFile(fileName) {
    state.attachedFiles = state.attachedFiles.filter(f => f.name !== fileName);
    elements.filePreviewArea.innerHTML = '';
    state.attachedFiles.forEach(displayFilePreview);
  }

  // Project Management
  function saveCurrentProject(name, code, description) {
    const project = {
      id: Date.now(),
      name: name,
      code: code,
      description: description,
      created: new Date().toISOString()
    };
    
    state.currentProject = project;
    
    const existingIndex = state.projectMemory.findIndex(p => p.name === name);
    if (existingIndex >= 0) {
      state.projectMemory[existingIndex] = project;
    } else {
      state.projectMemory.push(project);
      if (state.projectMemory.length > 10) {
        state.projectMemory.shift();
      }
    }
    
    updateMemoryIndicator();
  }

  function extractProjectName(message) {
    const patterns = [
      /(?:make|build|create|design)\s+(?:a|an|me)?\s*(.+?)(?:\s+for|\s+with|\s+that|$)/i
    ];
    
    for (let pattern of patterns) {
      const match = message.match(pattern);
      if (match && match[1]) {
        return match[1].trim().substring(0, 30);
      }
    }
    
    return null;
  }

  function buildContextPrompt() {
    let context = '';
    
    if (state.currentProject) {
      context += `\n\nCURRENT PROJECT: ${state.currentProject.name}\n${state.currentProject.description}`;
    }
    
    if (state.projectMemory.length > 0) {
      context += `\n\nPREVIOUS PROJECTS: ${state.projectMemory.map(p => p.name).join(', ')}`;
    }
    
    return context;
  }

  // Code Preview
  function runPreview(code) {
    elements.preview.srcdoc = code;
    elements.preview.classList.add('visible');
    elements.codeContent.textContent = code;
    elements.codePanel.classList.add('visible');
  }

  // API Communication
  async function askClaude(userMessage) {
    if (state.isProcessing) return;
    state.isProcessing = true;
    
    const thinkingMsg = showThinking();
    
    try {
      const messageContent = [];
      
      for (let file of state.attachedFiles) {
        if (file.base64) {
          messageContent.push({
            type: 'image',
            source: {
              type: 'base64',
              media_type: file.type,
              data: file.base64
            }
          });
        } else if (file.text) {
          userMessage += `\n\nAttached file "${file.name}":\n${file.text}`;
        }
      }
      
      messageContent.push({
        type: 'text',
        text: userMessage
      });
      
      state.conversationHistory.push({
        role: 'user',
        content: messageContent
      });

      const systemPrompt = `You are Lil Cuh, an ultra-intelligent AI with expertise in coding, health, fitness, medical diagnosis, and culinary arts (1000+ recipes). Keep it casual but expert-level.

CRITICAL: For code/build requests, respond with ONLY the complete HTML code. No explanations before or after.

For recipes: give full recipe with ingredients, steps, times, and tips.
For health: ask questions, give advice with disclaimers.
For debugging: analyze thoroughly.

${buildContextPrompt()}`;

      const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 4096,
          system: systemPrompt,
          messages: state.conversationHistory
        })
      });

      if (!response.ok) {
        throw new Error(`API Error: ${response.status}`);
      }

      const data = await response.json();
      removeMessage(thinkingMsg);

      if (data.content && data.content[0]) {
        const reply = data.content[0].text;
        
        state.conversationHistory.push({
          role: 'assistant',
          content: reply
        });

        const codeMarkers = [
          reply.trim().startsWith('<!DOCTYPE'),
          reply.trim().startsWith('<html'),
          reply.includes('```html'),
          reply.includes('<style') && reply.includes('</style>')
        ];
        
        const isCode = codeMarkers.some(marker => marker);

        if (isCode) {
          let code = reply;
          code = code.replace(/```html\n?/gi, '').replace(/```\n?/g, '');
          
          const htmlMatch = code.match(/(<!DOCTYPE[\s\S]*<\/html>)/i) || 
                           code.match(/(<html[\s\S]*<\/html>)/i);
          if (htmlMatch) {
            code = htmlMatch[1];
          }
          
          code = code.trim();
          
          const projectName = extractProjectName(userMessage) || `Project ${Date.now()}`;
          saveCurrentProject(projectName, code, userMessage);
          
          const actions = [
            {
              label: 'Modify', 
              handler: () => {
                elements.input.value = 'modify this: ';
                elements.input.focus();
              }
            },
            {
              label: 'Debug', 
              handler: debugCode
            },
            {
              label: 'Save', 
              handler: exportCode
            }
          ];
          
          addMessage('Here you go!', 'bot', actions);
          runPreview(code);
          
        } else {
          addMessage(reply, 'bot');
        }
        
        state.attachedFiles = [];
        elements.filePreviewArea.innerHTML = '';
        
      } else {
        addMessage('Something went wrong. Try again?', 'bot');
      }

    } catch (error) {
      removeMessage(thinkingMsg);
      console.error('Error:', error);
      addMessage('Network error. Make sure you have internet connection.', 'bot');
    } finally {
      state.isProcessing = false;
    }
  }

  async function generateImage() {
    const prompt = elements.input.value.trim() || 'a cool neon cyberpunk design';
    elements.input.value = '';
    addMessage(`Generating image: "${prompt}"...`, 'bot');
    
    const thinkingMsg = showThinking();
    
    try {
      const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 1024,
          messages: [{
            role: 'user',
            content: `Create an SVG image of: ${prompt}. Respond with ONLY the SVG code, no explanations.`
          }]
        })
      });
      
      const data = await response.json();
      removeMessage(thinkingMsg);
      
      if (data.content && data.content[0]) {
        let svg = data.content[0].text.replace(/```svg\n?/g, '').replace(/```\n?/g, '').trim();
        const blob = new Blob([svg], {type: 'image/svg+xml'});
        const url = URL.createObjectURL(blob);
        addMessage('Here\'s your generated image!', 'bot', [], url);
      }
    } catch (e) {
      removeMessage(thinkingMsg);
      addMessage('Couldn\'t generate the image. Try again?', 'bot');
    }
  }

  async function debugCode() {
    if (!state.currentProject || !state.currentProject.code) {
      addMessage('No code to debug yet. Build something first!', 'bot');
      return;
    }
    
    addMessage('Running code analysis...', 'bot');
    const thinkingMsg = showThinking();
    
    try {
      const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 2048,
          messages: [{
            role: 'user',
            content: `Analyze this code for bugs, performance issues, and security problems:\n\n${state.currentProject.code}`
          }]
        })
      });
      
      const data = await response.json();
      removeMessage(thinkingMsg);
      
      if (data.content && data.content[0]) {
        addMessage('Debug Report:\n\n' + data.content[0].text, 'bot');
      }
    } catch (e) {
      removeMessage(thinkingMsg);
      addMessage('Debug failed. Try again?', 'bot');
    }
  }

  // Button Actions
  function copyCode() {
    if (navigator.clipboard) {
      navigator.clipboard.writeText(elements.codeContent.textContent).then(() => {
        const original = elements.copyBtn.textContent;
        elements.copyBtn.textContent = 'Copied!';
        setTimeout(() => elements.copyBtn.textContent = original, 2000);
      });
    }
  }

  function exportCode() {
    if (!state.currentProject) {
      addMessage('No code to export yet!', 'bot');
      return;
    }
    
    const blob = new Blob([state.currentProject.code], {type: 'text/html'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${state.currentProject.name.replace(/\s+/g, '_')}.html`;
    a.click();
    URL.revokeObjectURL(url);
    
    addMessage('Code exported!', 'bot');
  }

  function clearMemory() {
    if (confirm('Clear all memory?')) {
      state.projectMemory = [];
      state.currentProject = null;
      state.conversationHistory = [];
      updateMemoryIndicator();
      addMessage('Memory cleared!', 'bot');
    }
  }

  function showMemory() {
    if (state.projectMemory.length === 0) {
      addMessage('No projects yet!', 'bot');
      return;
    }
    
    let msg = 'Your projects:\n\n';
    state.projectMemory.forEach((p, i) => {
      msg += `${i+1}. ${p.name}\n`;
    });
    
    const actions = state.projectMemory.slice(-3).map(p => ({
      label: p.name.substring(0, 18),
      handler: () => {
        runPreview(p.code);
        state.currentProject = p;
        addMessage(`Loaded "${p.name}"`, 'bot');
      }
    }));
    
    addMessage(msg, 'bot', actions);
  }

  function newProject() {
    state.currentProject = null;
    state.conversationHistory = [];
    elements.preview.classList.remove('visible');
    elements.codePanel.classList.remove('visible');
    elements.suggestions.innerHTML = '';
    addMessage('New project started!', 'bot');
  }

  async function sendMessage() {
    const text = elements.input.value.trim();
    if (!text && state.attachedFiles.length === 0) return;
    if (state.isProcessing) return;

    elements.input.disabled = true;
    elements.sendBtn.disabled = true;

    if (text) addMessage(text, 'user');
    
    if (state.attachedFiles.length > 0) {
      state.attachedFiles.forEach(f => {
        addMessage(`Attached: ${f.name}`, 'user');
      });
    }
    
    elements.input.value = '';
    elements.input.style.height = 'auto';
    elements.suggestions.innerHTML = '';

    await askClaude(text || 'Analyze files');

    elements.input.disabled = false;
    elements.sendBtn.disabled = false;
    elements.input.focus();
  }

  // Event Listeners
  elements.sendBtn.addEventListener('click', sendMessage);
  
  elements.input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey && !elements.input.disabled) {
      e.preventDefault();
      sendMessage();
    }
  });

  elements.input.addEventListener('input', () => {
    elements.input.style.height = 'auto';
    elements.input.style.height = Math.min(elements.input.scrollHeight, 120) + 'px';
  });

  elements.attachBtn.addEventListener('click', () => {
    elements.fileInput.click();
  });

  elements.fileInput.addEventListener('change', (e) => {
    if (e.target.files.length > 0) {
      handleFiles(e.target.files);
      e.target.value = '';
    }
  });

  elements.imageGenBtn.addEventListener('click', generateImage);
  elements.debugBtn.addEventListener('click', debugCode);
  elements.copyBtn.addEventListener('click', copyCode);
  elements.clearMemBtn.addEventListener('click', clearMemory);
  elements.showMemBtn.addEventListener('click', showMemory);
  elements.exportBtn.addEventListener('click', exportCode);
  elements.newProjBtn.addEventListener('click', newProject);

  // Initialize
  function init() {
    addMessage('Ay. I\'m Lil Cuh - ultra-intelligent AI. I can code, give health advice, share 1000+ recipes, and more. What\'s good?', 'bot');
    
    showSuggestions([
      'Build me a game',
      'Recipe for tacos',
      'Create workout plan',
      'Debug code'
    ]);
    
    updateMemoryIndicator();
    elements.input.focus();
  }

  // Start the app
  init();

})();
</script>
</body>
</html>